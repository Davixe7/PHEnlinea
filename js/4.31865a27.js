(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4,7],{4827:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"visits"}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-md-4 q-px-md q-mb-md"},[t.apartments.length?e("visit-form"):e("q-card",[e("q-card-section",[e("q-skeleton",{staticClass:"q-mb-md",attrs:{type:"QInput"}}),e("q-skeleton",{staticClass:"q-mb-md",attrs:{type:"QInput"}}),e("q-skeleton",{staticClass:"q-mb-md",attrs:{type:"QInput"}}),e("q-skeleton",{staticClass:"q-mb-md",attrs:{type:"QInput"}}),e("q-skeleton",{staticClass:"q-mb-md",attrs:{type:"QInput"}})],1),e("q-card-actions",{staticClass:"q-gutter-md",attrs:{align:"right"}},[e("q-skeleton",{attrs:{type:"QBtn"}}),e("q-skeleton",{attrs:{type:"QBtn"}})],1)],1)],1),e("div",{staticClass:"col-12 col-md-8 q-px-md q-mb-md"},[e("visits-table",{staticStyle:{"max-width":"100%"}})],1)])])},s=[],n=function(){var t=this,e=t._self._c,a=t._self._setupProxy;return e("div",{attrs:{id:"visit-form"}},[a.camera?e(a.Camera,{on:{pictureTaken:a.getCameraPicture,cameraClosed:function(t){a.camera=!1}}}):t._e(),e("q-card",{attrs:{flat:"",bordered:""}},[e("q-card-section",[e("div",{staticClass:"text-h5 text-bold q-px-none"},[t._v("\n        Registrar visita\n      ")])]),e("q-card-section",[e("div",{staticClass:"row align-center justify-center"},[a.visitor.picture?e("div",{staticClass:"col"},[e("q-img",{staticStyle:{height:"140px","max-width":"150px"},attrs:{src:a.visitor.picture,"spinner-color":"white"}})],1):t._e()])]),e("q-card-section",[e("q-input",{staticClass:"q-mb-md",attrs:{outlined:"","stack-label":"",type:"text",label:"Apartamento"},model:{value:a.extension_name,callback:function(t){a.extension_name=t},expression:"extension_name"}}),e("div",{staticClass:"row q-col-gutter-x-md items-center"},[e("div",{staticClass:"col"},[e("q-input",{ref:"InputDni",staticClass:"q-mb-md",attrs:{required:"",outlined:"","stack-label":"",type:"text",label:"Cédula"},on:{blur:a.fetchVisitor},model:{value:a.visitor.dni,callback:function(e){t.$set(a.visitor,"dni",e)},expression:"visitor.dni"}})],1),e("div",{staticClass:"col"},[e("q-input",{ref:"InputName",staticClass:"q-mb-md",attrs:{required:"",outlined:"","stack-label":"",type:"text",label:"Nombre"},model:{value:a.visitor.name,callback:function(e){t.$set(a.visitor,"name",e)},expression:"visitor.name"}})],1)]),e("div",{staticClass:"row q-col-gutter-x-md"},[e("div",{staticClass:"col"},[e("q-input",{ref:"InputPhone",staticClass:"q-mb-md",attrs:{outlined:"","stack-label":"",type:"text",label:"Celular"},model:{value:a.visitor.phone,callback:function(e){t.$set(a.visitor,"phone",e)},expression:"visitor.phone"}})],1),e("div",{staticClass:"col"},[e("q-input",{staticClass:"q-mb-md",attrs:{outlined:"","stack-label":"",type:"text",label:"Placa (opcional)"},model:{value:a.visitor.plate,callback:function(e){t.$set(a.visitor,"plate",e)},expression:"visitor.plate"}})],1)]),e("div",{staticClass:"q-mb-md"},[e("q-radio",{staticClass:"q-mr-md",attrs:{dense:"",val:"singular",label:"Personal"},model:{value:a.visitor.type,callback:function(e){t.$set(a.visitor,"type",e)},expression:"visitor.type"}}),e("q-radio",{attrs:{dense:"",val:"company",label:"Empresa"},model:{value:a.visitor.type,callback:function(e){t.$set(a.visitor,"type",e)},expression:"visitor.type"}})],1),"company"==a.visitor.type?e("div",{staticClass:"row"},[e("div",{staticClass:"col q-pr-md"},[e("q-input",{ref:"InputCompany",staticClass:"q-mb-md",attrs:{required:"",outlined:"",type:"text",label:"Nombre de la Empresa"},model:{value:a.visitor.company,callback:function(e){t.$set(a.visitor,"company",e)},expression:"visitor.company"}})],1),e("div",{staticClass:"col q-pr-md"},[e("q-input",{staticClass:"q-mb-md",attrs:{outlined:"",type:"text",label:"ARL"},model:{value:a.visitor.arl,callback:function(e){t.$set(a.visitor,"arl",e)},expression:"visitor.arl"}})],1),e("div",{staticClass:"col"},[e("q-input",{staticClass:"q-mb-md",attrs:{outlined:"",type:"text",label:"EPS"},model:{value:a.visitor.eps,callback:function(e){t.$set(a.visitor,"eps",e)},expression:"visitor.eps"}})],1)]):t._e(),e("div",{staticClass:"flex q-gutter-x-md"},[a.visitor.picture?t._e():e("q-btn",{attrs:{primary:"",loading:a.loading,icon:"camera",color:"primary",label:"Tomar foto"},on:{click:function(t){a.camera=!0}}}),e("q-btn",{staticClass:"q-ml-auto",attrs:{flat:"",color:"primary",loading:a.loading},on:{click:function(t){return a.clearForm()}}},[t._v("\n          Borrar\n        ")]),e("q-btn",{staticClass:"bg-black text-white",attrs:{dark:"",loading:a.loading},on:{click:a.storeVisit}},[t._v("\n          Guardar\n        ")])],1),t._e()],1)],1)],1)},r=[],l=(a("e6cf"),a("ded3")),o=a.n(l),c=a("2b0e"),d=a("b817"),u=a("bc3a"),p=a.n(u),m=a("4360"),h={__name:"VisitForm",setup(t){const e=Object(c["b"])(!1),a=Object(c["b"])(!1),i=Object(c["b"])(!1),s=Object(c["b"])(null),n=Object(c["b"])({dni:"",name:"",phone:"",plate:"",type:"singular",company:"",arl:"",eps:""});function r(){p.a.get("https://phenlinea.com/api/visitors",{params:{dni:n.value.dni},headers:{Accept:"application/json","Content-Type":"application/json"}}).then((t=>n.value=o()({},t.data.data)))}function l(t){a.value=!1,i.value=t}async function u(){s.value&&(e.value=!0,await m["a"].dispatch("storeVisit",h()),v(),e.value=!1)}function h(){let t=new FormData;return Object.keys(n.value).forEach((e=>t.append(e,n.value[e]))),n.value.id&&t.append("visitor_id",n.value.id),t.append("picture",i.value),t.append("extension_name",s.value),t}function v(){n.value={dni:"",name:"",phone:"",plate:"",type:"singular",company:"",arl:"",eps:""}}return{__sfc:!0,loading:e,camera:a,pictureURL:i,extension_name:s,visitor:n,fetchVisitor:r,getCameraPicture:l,storeVisit:u,loadData:h,clearForm:v,Camera:d["default"]}}},v=h,b=a("2877"),f=a("f09f"),q=a("a370"),g=a("068f"),k=a("27f9"),x=a("3786"),y=a("9c40"),C=a("7d53"),w=a("0016"),_=a("eebe"),Q=a.n(_),$=Object(b["a"])(v,n,r,!1,null,null,null),V=$.exports;Q()($,"components",{QCard:f["a"],QCardSection:q["a"],QImg:g["a"],QInput:k["a"],QRadio:x["a"],QBtn:y["a"],QFile:C["a"],QIcon:w["a"]});var I=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"visits-table"}},[t.loading?e("table-skeleton"):e("q-table",{attrs:{flat:"",bordered:"",title:"Visitas",columns:t.columns,data:t.visits,filter:t.search},scopedSlots:t._u([{key:"top-right",fn:function(){return[e("q-input",{attrs:{dense:"",debounce:"300",placeholder:"Buscar"},scopedSlots:t._u([{key:"append",fn:function(){return[e("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),e("q-btn",{attrs:{icon:"refresh",round:"",flat:"",color:"primary",loading:t.loading},on:{click:t.updateVisits}})]},proxy:!0},{key:"body-cell-picture",fn:function(a){return[e("q-td",{attrs:{props:a},on:{click:function(e){return t.setPicture(a.row,"picture")}}},[e("q-avatar",{attrs:{color:"grey","text-color":"white"}},[a.row.picture?e("img",{attrs:{src:a.row.picture}}):t._e()])],1)]}},{key:"body-cell-qrcode",fn:function(a){return[e("q-td",{attrs:{props:a},on:{click:function(e){return t.setPicture(a.row,"qrcode")}}},[e("q-avatar",{attrs:{color:"grey","text-color":"white"}},[a.row.qrcode?e("img",{attrs:{src:a.row.qrcode}}):t._e()])],1)]}},{key:"body-cell-checkout",fn:function(a){return[e("q-td",{attrs:{props:a}},[a.row.checkout?e("div",[t._v("\n          "+t._s(a.row.checkout)+"\n        ")]):e("mark-checkout",{attrs:{visit:a.row}})],1)]}}])}),e("q-dialog",{model:{value:t.pictureDialog,callback:function(e){t.pictureDialog=e},expression:"pictureDialog"}},[e("q-card",{staticStyle:{width:"320px"}},[e("q-card-section",[e("img",{staticStyle:{"max-width":"100%"},attrs:{src:t.picture,alt:"#"}})]),e("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"OK"}})],1)],1)],1)],1)},P=[],S=(a("a79d"),a("ff4b")),j=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"mark-checkout"}},[e("q-btn",{attrs:{flat:"",loading:t.loading},on:{click:t.updateVisit}},[e("q-icon",{attrs:{name:"done_all"}})],1)],1)},O=[],D={props:["visit"],data(){return{loading:!1}},methods:{updateVisit(){this.loading=!0,this.$store.dispatch("updateVisit",this.visit).then((t=>{})).then((t=>{this.loading=!1}))}}},T=D,B=Object(b["a"])(T,j,O,!1,null,null,null),A=B.exports;Q()(B,"components",{QBtn:y["a"],QIcon:w["a"]});var M={components:{TableSkeleton:S["a"],MarkCheckout:A},name:"VisitsTable",computed:{visits(){return this.$store.state.visits.visits}},data(){return{pictureDialog:!1,loading:!0,search:"",picture:"",columns:[{name:"picture",field:"picture",required:!0,label:"Foto",align:"left",sortable:!1},{name:"qrcode",field:"qrcode",required:!0,label:"QR",align:"left",sortable:!1},{name:"pwd",field:"password",required:!0,label:"PWD",align:"left",sortable:!1},{name:"apartment",field:t=>t.extension_name,required:!0,label:"APTO",align:"left"},{name:"DNI",field:"dni",required:!0,label:"Cédula",align:"left"},{name:"name",field:"name",required:!0,label:"Nombre",align:"left"},{name:"plate",field:t=>t.plate?t.plate:"",required:!0,label:"Placa",align:"left"},{name:"company",field:"company",required:!0,label:"Empresa",align:"left"},{name:"arl_eps",field:t=>t.arl_eps?t.arl_eps:"",required:!0,label:"ARL-EPS",align:"left"},{name:"checkin",field:"checkin",required:!0,label:"Entrada",align:"left",sortable:!0},{name:"checkout",field:"checkout",required:!0,label:"Salida",align:"left",sortable:!0}]}},methods:{setPicture(t,e){t[e]&&(this.pictureDialog=!0,this.picture=t[e])},updateVisits(){this.loading=!0,this.$store.dispatch("fetchVisits").finally((()=>this.loading=!1))}},mounted(){this.$store.dispatch("fetchVisits").then((t=>{this.loading=!1}))}},E=M,F=a("eaac"),N=a("db86"),R=a("cb32"),U=a("24e8"),G=a("4b7e"),L=a("7f67"),J=Object(b["a"])(E,I,P,!1,null,null,null),W=J.exports;Q()(J,"components",{QTable:F["a"],QInput:k["a"],QIcon:w["a"],QBtn:y["a"],QTd:N["a"],QAvatar:R["a"],QDialog:U["a"],QCard:f["a"],QCardSection:q["a"],QCardActions:G["a"]}),Q()(J,"directives",{ClosePopup:L["a"]});var z={components:{VisitForm:V,VisitsTable:W},data(){return{camera:!1}},computed:{apartments(){return this.$store.getters.apartments?this.$store.getters.apartments:[]}},mounted(){this.$store.dispatch("fetchApartments").then((t=>{}))}},H=z,K=a("293e"),X=Object(b["a"])(H,i,s,!1,null,null,null);e["default"]=X.exports;Q()(X,"components",{QCard:f["a"],QCardSection:q["a"],QSkeleton:K["a"],QCardActions:G["a"]})},"52a8":function(t,e,a){"use strict";a("80a5")},"80a5":function(t,e,a){},b817:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"camera"}},[e("video",{ref:"video",attrs:{id:"video"},on:{canplay:t.setDimensions}}),e("div",{staticClass:"camera-actions"},[e("q-btn",{staticClass:"q-mr-md",attrs:{color:"white","text-color":"black",label:"Cancelar"},on:{click:function(e){return t.$emit("cameraClosed")}}}),e("q-btn",{attrs:{label:"Capturar",color:"primary",icon:"camera"},on:{click:t.takePicture}})],1),e("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"canvas"})])},s=[],n={name:"Camera",data(){return{width:640,height:0}},props:{fullscreen:Boolean},methods:{startVideo(){if(navigator.getMedia=navigator.getUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia,!navigator.getMedia)return;let t=this;navigator.getMedia({video:!0,audio:!1},(function(e){t.$refs.video.srcObject=e,t.$refs.video.play()}),(function(t){console.log(t)}))},setDimensions(){this.height=this.$refs.video.videoHeight/(this.$refs.video.videoWidth/this.width),this.$refs.video.width=this.width,this.$refs.video.height=this.height,this.$refs.canvas.width=this.width,this.$refs.canvas.height=this.height},takePicture(){this.$refs.canvas.getContext("2d").drawImage(this.$refs.video,0,0,this.width,this.height);let t=this;this.$refs.canvas.toBlob((function(e){t.$emit("pictureTaken",e)}))}},mounted(){this.startVideo()}},r=n,l=(a("52a8"),a("2877")),o=a("9c40"),c=a("eebe"),d=a.n(c),u=Object(l["a"])(r,i,s,!1,null,"4b1d8450",null);e["default"]=u.exports;d()(u,"components",{QBtn:o["a"]})},ff4b:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"q-pa-md"},[e("q-markup-table",[e("thead",[e("tr",[e("th",{staticClass:"text-left",staticStyle:{width:"150px"}},[e("q-skeleton",{attrs:{animation:"blink",type:"text"}})],1),e("th",{staticClass:"text-right"},[e("q-skeleton",{attrs:{animation:"blink",type:"text"}})],1),e("th",{staticClass:"text-right"},[e("q-skeleton",{attrs:{animation:"blink",type:"text"}})],1),e("th",{staticClass:"text-right"},[e("q-skeleton",{attrs:{animation:"blink",type:"text"}})],1),e("th",{staticClass:"text-right"},[e("q-skeleton",{attrs:{animation:"blink",type:"text"}})],1),e("th",{staticClass:"text-right"},[e("q-skeleton",{attrs:{animation:"blink",type:"text"}})],1)])]),e("tbody",t._l(5,(function(t){return e("tr",{key:t},[e("td",{staticClass:"text-left"},[e("q-skeleton",{attrs:{animation:"blink",type:"text",width:"85px"}})],1),e("td",{staticClass:"text-right"},[e("q-skeleton",{attrs:{animation:"blink",type:"text",width:"50px"}})],1),e("td",{staticClass:"text-right"},[e("q-skeleton",{attrs:{animation:"blink",type:"text",width:"35px"}})],1),e("td",{staticClass:"text-right"},[e("q-skeleton",{attrs:{animation:"blink",type:"text",width:"65px"}})],1),e("td",{staticClass:"text-right"},[e("q-skeleton",{attrs:{animation:"blink",type:"text",width:"25px"}})],1),e("td",{staticClass:"text-right"},[e("q-skeleton",{attrs:{animation:"blink",type:"text",width:"85px"}})],1)])})),0)])],1)},s=[],n={name:"TableSkeleton"},r=n,l=a("2877"),o=a("2bb1"),c=a("293e"),d=a("eebe"),u=a.n(d),p=Object(l["a"])(r,i,s,!1,null,"0de77220",null);e["a"]=p.exports;u()(p,"components",{QMarkupTable:o["a"],QSkeleton:c["a"]})}}]);